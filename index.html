<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HV Cable Installation – SWMS Form</title>
  <!--
    This page is a bespoke web form based on the supplied Safe Work Method Statement
    (SWMS) for HV cabling.  It retains the original logos and risk‐rating diagrams
    from the provided document while exposing all of the sign‑off areas as
    interactive form controls.  Users can add additional rows to any of the
    signature tables or the task table with one click, ensuring that the form can
    accommodate teams of varying size.  Each input uses sensible types (e.g. dates
    for date fields, numbers for risk rankings) to aid validation.  Styles are kept
    deliberately simple so that the layout matches the clean, tabular appearance of
    the original Word document.
  -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      color: #111;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1em;
    }
    th, td {
      border: 1px solid #333;
      padding: 6px;
      vertical-align: top;
    }
    th {
      background-color: #f0f0f0;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .header img {
      max-height: 80px;
    }
    h1 {
      margin-top: 0;
      font-size: 1.8em;
    }
    h2 {
      margin-top: 0;
      font-size: 1.4em;
    }
    button.add-row {
      margin-top: 0.5em;
      margin-bottom: 1.5em;
      padding: 0.4em 0.8em;
      font-size: 0.9em;
      cursor: pointer;
    }
    /* Give images a little breathing room */
    .risk-images img {
      margin-right: 10px;
      max-width: 100%;
      height: auto;
    }
    /* Prevent images in the PPE table from becoming too large */
    .ppe-table img {
      max-width: 60px;
      height: auto;
      display: block;
      margin: 0 auto 4px;
    }
    .ppe-table td {
      text-align: center;
      vertical-align: top;
    }

        /* Increase the height of read-only textareas in the task table so
           that the full hazard/control text is visible without scrolling */
        #task-table textarea[readonly] {
          height: 100px;
        }
  </style>
  <script>
    /**
     * Clone the first body row of the specified table and append it to the end.
     * All input and textarea values are cleared so that the new row is blank.
     *
     * @param {string} tableId The DOM id of the table to extend.
     * @param {number} columnCount The number of columns to insert for simple tables
     *                             (used when there is no example row yet).  When
     *                             omitted, the first row in the tbody is cloned.
     */
    function addRow(tableId, columnCount) {
      const table = document.getElementById(tableId);
      if (!table) return;
      const tbody = table.getElementsByTagName('tbody')[0];
      let newRow;
      if (tbody && tbody.rows.length > 0) {
        // Clone the first existing row
        newRow = tbody.rows[0].cloneNode(true);
        // Clear all form controls in the cloned row
        Array.from(newRow.querySelectorAll('input, textarea')).forEach(el => {
          if (el.type === 'checkbox') {
            el.checked = false;
          } else {
            el.value = '';
          }
        });
      } else if (columnCount) {
        // Create a blank row with the specified number of columns
        newRow = document.createElement('tr');
        for (let i = 0; i < columnCount; i++) {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'text';
          td.appendChild(input);
          newRow.appendChild(td);
        }
      }
      if (tbody) tbody.appendChild(newRow);
      // Reinitialise signature pads if we're adding to the acknowledgement table.
      // Avoid redeclaring the table variable again: use the existing tableId
      if (tableId === 'acknowledgement') {
        initSignaturePads();
      }
    }

    /**
     * Add a new blank row to the task table.  The job sequence, hazards and
     * controls columns use textarea elements to accommodate longer text, while
     * the risk rankings use number inputs constrained to 1–5.
     */
    function addTaskRow() {
      const table = document.getElementById('task-table');
      if (!table) return;
      const tbody = table.getElementsByTagName('tbody')[0];
      const row = document.createElement('tr');
      const cols = ['job', 'hazards', 'controls', 'init', 'res', 'resp'];
      cols.forEach((col, index) => {
        const td = document.createElement('td');
        if (index < 3) {
          const textarea = document.createElement('textarea');
          textarea.rows = 3;
          textarea.name = col + '[]';
          td.appendChild(textarea);
        } else if (index < 5) {
          const input = document.createElement('input');
          input.type = 'number';
          input.min = 1;
          input.max = 5;
          input.name = col + '[]';
          td.appendChild(input);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.name = col + '[]';
          td.appendChild(input);
        }
        row.appendChild(td);
      });
      tbody.appendChild(row);
    }

  /**
   * Initialise signature pads (hand‑drawn canvases) for all canvases with the
   * class 'signature-pad'.  Each canvas captures mouse/touch movements to
   * produce a freehand signature.  When the user draws on a canvas the
   * data-signed attribute is set to 'true', allowing the submit handler to
   * verify that a signature has been provided.
   */
  function initSignaturePads() {
    const pads = document.querySelectorAll('canvas.signature-pad');
    pads.forEach(canvas => {
      if (canvas.dataset.initialized) return;
      const ctx = canvas.getContext('2d');
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 1.5;
      let drawing = false;
      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }
      function start(e) {
        drawing = true;
        const { x, y } = getPos(e);
        ctx.beginPath();
        ctx.moveTo(x, y);
        canvas.dataset.signed = 'true';
        e.preventDefault();
      }
      function move(e) {
        if (!drawing) return;
        const { x, y } = getPos(e);
        ctx.lineTo(x, y);
        ctx.stroke();
        e.preventDefault();
      }
      function end() {
        drawing = false;
      }
      // Mouse events
      canvas.addEventListener('mousedown', start);
      canvas.addEventListener('mousemove', move);
      canvas.addEventListener('mouseup', end);
      canvas.addEventListener('mouseleave', end);
      // Touch events
      canvas.addEventListener('touchstart', start);
      canvas.addEventListener('touchmove', move);
      canvas.addEventListener('touchend', end);
      canvas.dataset.initialized = 'true';
    });
  }

  // Initialise existing signature pads on page load
  window.addEventListener('DOMContentLoaded', initSignaturePads);
  </script>
</head>
<body>
  <div class="header">
    <img src="image2.png" alt="PBE logo" />
    <img src="image1.png" alt="Torrens to Darlington Alliance logo" />
  </div>
  <h1>Safe Work Method Statement</h1>
  <h2>SWMS‑HV‑01 – HV Cable Installation</h2>

  <h3>Project &amp; Contact Details</h3>
  <table>
    <tbody>
      <tr><th>SWMS Reference No.</th><td>SWMS‑HV‑01</td></tr>
      <tr><th>Job Description</th><td>HV Cable Installation</td></tr>
      <tr><th>Location</th><td>T2D Waterloo Corner Precast Facility, 32 Dunn Rd, Waterloo Corner SA 5110</td></tr>
      <tr><th>Principal Contractor</th><td>T2D CJV (John Holland Pty Ltd &amp; Bouygues Construction Australia Pty Ltd)</td></tr>
      <tr><th>Project/Site Manager – Contact</th><td>Chris Hoogwerf – 0491 355 760</td></tr>
      <tr><th>SWMS Prepared By – Date</th><td>Chris Hoogwerf – 24‑Aug‑2025</td></tr>
    </tbody>
  </table>

  <h3>Management Review (Sign‑off)</h3>
  <table id="management-review">
    <thead>
      <tr>
        <th>Role</th>
        <th>Name</th>
        <th>Signature</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" name="m_role[]" /></td>
        <td><input type="text" name="m_name[]" /></td>
        <td><input type="text" name="m_signature[]" /></td>
        <td><input type="date" name="m_date[]" /></td>
      </tr>
    </tbody>
  </table>
  <button type="button" class="add-row" onclick="addRow('management-review', 4)">Add Row</button>

  <h3>Worker Review (Acknowledgment)</h3>
  <table id="worker-review">
    <thead>
      <tr>
        <th>Role</th>
        <th>Name</th>
        <th>Signature</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" name="w_role[]" /></td>
        <td><input type="text" name="w_name[]" /></td>
        <td><input type="text" name="w_signature[]" /></td>
        <td><input type="date" name="w_date[]" /></td>
      </tr>
    </tbody>
  </table>
  <button type="button" class="add-row" onclick="addRow('worker-review', 4)">Add Row</button>

  <h3>High Risk Construction Work (tick all that apply)</h3>
  <table>
    <tbody>
      <tr>
        <td><input type="checkbox" id="hr1" /> <label for="hr1">Work on or near energised electrical installations or services</label></td>
        <td><input type="checkbox" id="hr2" /> <label for="hr2">Work in or near a shaft or trench deeper than 1.5 m or a tunnel</label></td>
        <td><input type="checkbox" id="hr3" /> <label for="hr3">Work in an area with movement of powered mobile plant</label></td>
      </tr>
      <tr>
        <td><input type="checkbox" id="hr4" /> <label for="hr4">Work on, in or adjacent to a traffic corridor</label></td>
        <td><input type="checkbox" id="hr5" /> <label for="hr5">Risk of a person falling more than 2 metres</label></td>
        <td><input type="checkbox" id="hr6" /> <label for="hr6">Tilt‑up or precast concrete elements</label></td>
      </tr>
      <tr>
        <td><input type="checkbox" id="hr7" /> <label for="hr7">Demolition of load‑bearing structure</label></td>
        <td><input type="checkbox" id="hr8" /> <label for="hr8">Work in or near a confined space</label></td>
        <td><input type="checkbox" id="hr9" /> <label for="hr9">Work on or near chemical, fuel or refrigerant lines</label></td>
      </tr>
      <tr>
        <td><input type="checkbox" id="hr10" /> <label for="hr10">Work on or near pressurised gas mains or piping</label></td>
        <td><input type="checkbox" id="hr11" /> <label for="hr11">Use of explosives</label></td>
        <td><input type="checkbox" id="hr12" /> <label for="hr12">Work in/near water with drowning risk</label></td>
      </tr>
    </tbody>
  </table>

  <h3>Mandatory Site‑Specific PPE</h3>
  <table class="ppe-table">
    <tbody>
      <tr>
        <td><input type="checkbox" id="ppe1" />
          <label for="ppe1">
            <img src="image3.jpeg" alt="Hard Hat" />
            <br />Hard Hat
          </label>
        </td>
        <td><input type="checkbox" id="ppe2" />
          <label for="ppe2">
            <img src="image4.jpeg" alt="Steel‑capped Boots" />
            <br />Steel‑capped Boots
          </label>
        </td>
        <td><input type="checkbox" id="ppe3" />
          <label for="ppe3">
            <img src="image5.jpeg" alt="Hi‑Vis Clothing" />
            <br />Hi‑Vis Clothing
          </label>
        </td>
      </tr>
      <tr>
        <td><input type="checkbox" id="ppe4" />
          <label for="ppe4">
            <img src="image6.jpeg" alt="Long Sleeves &amp; Trousers" />
            <br />Long Sleeves &amp; Trousers
          </label>
        </td>
        <td><input type="checkbox" id="ppe5" />
          <label for="ppe5">
            <img src="image7.jpeg" alt="Safety Glasses" />
            <br />Safety Glasses
          </label>
        </td>
        <td><input type="checkbox" id="ppe6" />
          <label for="ppe6">
            <img src="image8.jpeg" alt="Gloves" />
            <br />Gloves
          </label>
        </td>
      </tr>
      <tr>
        <td><input type="checkbox" id="ppe7" />
          <label for="ppe7">
            <img src="image9.jpeg" alt="Hearing Protection" />
            <br />Hearing Protection
          </label>
        </td>
        <td><input type="checkbox" id="ppe8" />
          <label for="ppe8">
            <img src="image10.jpeg" alt="Goggles" />
            <br />Goggles
          </label>
        </td>
        <td><input type="checkbox" id="ppe9" />
          <label for="ppe9">
            <img src="image11.jpeg" alt="P1/2 Mask" />
            <br />P1/2 Mask
          </label>
        </td>
      </tr>
      <tr>
        <td><input type="checkbox" id="ppe10" />
          <label for="ppe10">
            <img src="image12.jpeg" alt="P3 Mask" />
            <br />P3 Mask
          </label>
        </td>
        <td><input type="checkbox" id="ppe11" />
          <label for="ppe11">
            <img src="image13.jpeg" alt="Breathing Apparatus" />
            <br />Breathing Apparatus
          </label>
        </td>
        <td><input type="checkbox" id="ppe12" />
          <label for="ppe12">
            <img src="image14.jpeg" alt="Harness / Fall Arrest" />
            <br />Harness / Fall Arrest
          </label>
        </td>
      </tr>
    </tbody>
  </table>

  <!--
    Static guidance from the SWMS document.  These sections list the
    legislation, standards, emergency procedures and other critical controls
    that apply to HV cable installation.  They are presented as plain text
    lists so the information cannot be edited by users filling out the form.
  -->
  <h3>Relevant Legislation, Standards &amp; Codes</h3>
  <ul>
    <li>Work Health and Safety Act &amp; Regulations (SA)</li>
    <li>Codes of Practice: Excavation Work; Managing Electrical Risks in the Workplace</li>
    <li>AS/NZS 3000 (Wiring Rules)</li>
    <li>AS/NZS 3008 (Selection of Cables)</li>
  </ul>

  <h3>Emergency Response</h3>
  <ul>
    <li><strong>First Aid:</strong> Stop work. Do not touch casualty until circuit isolated.  Trained first aider and kit on site.  Call 000 if required.</li>
    <li><strong>Emergency Contact:</strong> Notify Site Supervisor; coordinate response.</li>
    <li><strong>Rescue Equipment:</strong> Insulated rescue crook; appropriate fire extinguisher.</li>
    <li><strong>Evacuation:</strong> Evacuate upwind; muster at designated assembly point.</li>
  </ul>

  <h3>Applicable GMRs &amp; Critical Controls (mapped to task controls)</h3>
  <ul>
    <li><strong>GMR&nbsp;1 – Traffic, Plant &amp; People</strong>
      <ul>
        <li>Exclusion zones, barriers and positive communication in work area.</li>
        <li>Operators licensed &amp;nbsp;+&amp;nbsp;VOC ≤ 2 years; daily pre‑starts.</li>
      </ul>
    </li>
    <li><strong>GMR&nbsp;4 – Electrical Safety</strong>
      <ul>
        <li>EWMP procedure; live testing only on test points; LVR kit &amp;nbsp;+&amp;nbsp;two‑person rule.</li>
        <li>Restricted Zones for commissioning/live testing; covers reinstated before energisation.</li>
      </ul>
    </li>
    <li><strong>GMR&nbsp;5 – Working at Height</strong>
      <ul>
        <li>Secondary protection on EWP; 2&nbsp;m drop‑zones; tethers/lanyards (as applicable).</li>
      </ul>
    </li>
    <li><strong>GMR&nbsp;8 – Isolation</strong>
      <ul>
        <li>Competent isolators; personal locks/tags; upstream isolation at lockable points; classify simple vs complex.</li>
      </ul>
    </li>
  </ul>

  <h3>Prohibited &amp; Restricted Tools/Practices</h3>
  <ul>
    <li>Comply with T2D‑APP‑PAE‑001‑01 (e.g., no 1&nbsp;mm cut‑off discs; ≥&nbsp;2&nbsp;mm only).</li>
  </ul>

  <h3>Permits Required for this SWMS</h3>
  <ul>
    <li>Simple or Complex Isolations; Energisation (as applicable); Working at Heights (if required); Hot Work (if applicable)</li>
  </ul>

  <h3>Safe Work Method – Steps, Hazards &amp; Controls</h3>
  <!--
    Prepopulate the SWMS steps, hazards and controls with the details from the
    original document. Users can still add additional rows using the Add Row
    button. The risk fields and responsible person remain editable to allow
    site‑specific risk ratings and responsibility assignments.
  -->
  <table id="task-table">
    <thead>
      <tr>
        <th>Job Sequence</th>
        <th>Hazards</th>
        <th>Controls</th>
        <th>Initial Risk (1–5)</th>
        <th>Residual Risk (1–5)</th>
        <th>Responsible Person</th>
      </tr>
    </thead>
    <tbody>
      <!-- Row populated from SWMS: Delivery of Plant -->
      <tr>
        <td><textarea rows="3" name="job[]" readonly>1. Delivery of Plant</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Injury or plant damage from collisions or rollovers; interaction with pedestrians and fixed objects.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Communicate and follow Vehicle Management Plan; establish traffic control and walkways; verify operator competence and VOC; conduct daily pre‑starts; maintain exclusion zones and positive communication; remove keys when idle; ensure ROPS and safety devices operational; mark and delineate local infrastructure.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <!-- Row populated from SWMS: Operation of EWP -->
      <tr>
        <td><textarea rows="3" name="job[]" readonly>2. Operation of EWP</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Plant failure; falls from height; dropped objects.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Licensed operators with current VOC; pre‑start checks; hard barrier exclusion zone with signage; competent ground rescuer; 2&nbsp;m drop‑zone exclusion; EWP TRA reviewed; secondary protection device fitted.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <!-- Row populated from SWMS: Install Electrical Services – Hang/Fix Cables -->
      <tr>
        <td><textarea rows="3" name="job[]" readonly>3. Install Electrical Services – Hang/Fix Cables</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Falls from height; dropped objects; contact with live services.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Use tethers/lanyards for tools; edge protection and kick boards; 2&nbsp;m exclusion below; apply isolations or maintain separation to energised equipment; correct fixings; permit for works at height signed on.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>

      <!-- Additional blank rows to bring the table to a total of 15 entries.
           These rows lock the Job Sequence, Hazards and Controls columns (read‑only)
           so users cannot modify the core content.  They provide space for
           additional risk ratings and responsible persons to be recorded. -->
      <!-- 4. Cable Installation -->
      <tr>
        <td><textarea rows="3" name="job[]" readonly>4. Cable Installation</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Cuts; manual handling; struck‑by; damage to other services/equipment; slips/trips; pinch points; trip hazards; cable damage during run‑out.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Evaluate site; wear CAT II / cut‑resistant gloves; inspect reels/stands and verify SWL; inspect rollers/rope; nominate person in control of pull; clear comms (radios/spotters); only trained operators for mechanical equipment; all persons can stop the pull; avoid “line of fire”; keep hands clear and cut ties flush; barricade layout area; avoid walkways; protect sharp edges; barricade trafficable areas.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>5. Install &amp; Mount Cable Support / Accessories</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Mechanical damage; strains; incorrect locations; slips/trips; hearing damage.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Install per AS 3012/3000; choose routes to minimise damage and interactions; use heavy‑duty conduit/tray where required; reposition plant or protect equipment; pre‑plan works; wear hearing protection; maintain housekeeping.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>6. Cable Preparation &amp; Terminations</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Cuts/strains; damage to cables/equipment; electric shock or arc flash.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Use cable strippers (no fixed blades); set depth correctly; cut away from body; use cut‑resistant gloves; keep area tidy; confirm isolation and test for dead per EWMP before work; wear arc‑rated PPE and insulating gloves.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>7. Energisation</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Electric shock; operation of incorrect plant; energising exposed equipment; injury to nearby persons.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Only licensed/verified workers; follow EWMP energisation procedure; barricade and sign Restricted Zones; confirm testing and documentation; reinstate covers; communicate with stakeholders; keep persons clear of arc zones; apply boundary isolations; manage induced/stored voltages; test results recorded and ECOC completed.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>8. Commissioning – Jumpers &amp; Control Wiring</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Bypassing safety systems; jumpers left in service; damage to equipment; injury.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Use violet jumpers with Danger tags; tag at jumper and externally; identify affected equipment and place tags; assess risk and obtain supervisor authorisation; maintain bridging register; remove jumpers ASAP; superintendent authorises high‑risk cases.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>9. Isolation of Electrical Equipment</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Electrocution; mechanical damage; incorrect isolations.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Follow EWMP/T2DA Isolation procedure; competent isolators; use personal locks/tags; isolate upstream; verify lockable isolation points; determine simple vs complex isolations; ensure not detrimental to others.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>10. Testing of Live Equipment</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Electric shock; arc flash exposure.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Only on test points with shielding of exposed conductors; LVR kit present and trained LVR/CPR person; two‑person rule; no alterations on live equipment; complete Live Risk Assessment; test at lowest protection settings where possible.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>11. Install/Fix Cables from Platform Ladders</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Falls; dropped materials; slips/trips.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Use approved 120 kg+ fiberglass platform ladders with back protection; inspect/tag; firm level ground; use only where EWP/scaffold impractical; observe edge distance; maintain three‑point contact; use tool pouches; maintain housekeeping.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>12. Use of Mains‑Powered Tools</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Electric shock from tools and test equipment.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Inspect leads/tools (no cuts, correct plugs); ensure RCD protection; current test tags; keep clean and dry; elevate leads; avoid wet areas; prefer cordless where possible.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>13. Manufacture/Install Cable Ladder/Tray; Catenary; Mount Equipment</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Eye injury from grinding; fires from sparks; cuts from sharp edges; dust/skin irritation; hearing loss.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Wear eye protection (goggles + face shield); no 1 mm cut‑off discs (≥ 2 mm only); screen off or avoid grinding near others; remove combustibles; hot work permit and extinguisher; prefer cold cut saw; deburr edges; wear cut‑resistant gloves; P2 respirator; follow SDS; appropriate gloves; hearing protection.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>14. Work Near/In Trenches – Conduits/Cable Support</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Collision with plant; strains; dust; falls into trenches.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Positive communication with plant; operate on suitable ground; use spotters; stand clear; excavation permit and design controls; obtain drawings and identify clashes; plan location of plant/materials outside zone of influence; barricades/signage/edge protection; maintain barricading; PPE including respiratory protection for dust; correct lifting; lighting for poor conditions; maintain 1:1 (or 1:1.5 wet) setback; use spotter during excavation.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
      <tr>
        <td><textarea rows="3" name="job[]" readonly>15. HV Cable Testing (VLF / IR / Sheath)</textarea></td>
        <td><textarea rows="3" name="hazards[]" readonly>Electric shock from HV test sets; arc‑flash from faulted terminations; stored/induced energy; inadvertent access to test area.</textarea></td>
        <td><textarea rows="3" name="controls[]" readonly>Authorised/licensed personnel only; test procedure per EWMP; permit/authorisation completed. Establish Restricted Zone around both ends of the circuit with barriers and “Danger – HV Testing” signage; control entry. Prove isolation, discharge and test for dead before connecting test set; consider induced voltages. Two‑person rule; LVR kit and trained LVR/CPR person present; test only on designed test points; cover other exposed conductors. Use HV test set rated for the cable with functional E‑stop, earthing/shorting, and controlled ramp‑up; use lowest energy settings consistent with the method statement. On completion, de‑energise, discharge, prove de‑energised, remove bonds, reinstate covers and update test records/ECOC.</textarea></td>
        <td><input type="number" min="1" max="5" name="init[]" /></td>
        <td><input type="number" min="1" max="5" name="res[]" /></td>
        <td><input type="text" name="resp[]" /></td>
      </tr>
    </tbody>
  </table>
  <button type="button" class="add-row" onclick="addTaskRow()">Add Row</button>


  <h3>Change Management / Amendments</h3>
  <table id="change-management">
    <thead>
      <tr>
        <th>Review No.</th>
        <th>Amendment Reason / Details</th>
        <th>Change Management Actions (communications)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" name="review_no[]" /></td>
        <td><input type="text" name="amendment_details[]" /></td>
        <td><input type="text" name="change_actions[]" /></td>
      </tr>
    </tbody>
  </table>
  <button type="button" class="add-row" onclick="addRow('change-management', 3)">Add Row</button>

  <h3>SWMS Acknowledgement &amp; Sign‑On</h3>
  <table id="acknowledgement">
    <thead>
      <tr>
        <th></th>
        <th>Print Name</th>
        <th>Signature</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="checkbox" name="acknowledged[]" /></td>
        <td><input type="text" name="ack_name[]" /></td>
        <!-- Replace text input with a canvas so users can hand draw their signature -->
        <td>
          <canvas class="signature-pad" width="200" height="60" data-signed="false" style="border:1px solid #333;"></canvas>
        </td>
        <td><input type="date" name="ack_date[]" /></td>
      </tr>
    </tbody>
  </table>
  <button type="button" class="add-row" onclick="addRow('acknowledgement', 4)">Add Row</button>

  <!-- Submit button to capture the completed form as a PDF and send a notification email -->
  <div style="margin-top: 20px; text-align: center;">
    <button type="button" style="padding: 10px 20px; font-size: 16px;" onclick="submitForm()">Submit Form</button>
  </div>

  <h3>Risk Rating Guide</h3>
  <div class="risk-images">
    <img src="image15.png" alt="Likelihood of Occurrence" />
    <img src="image16.png" alt="Action Required" />
    <img src="image17.png" alt="Risk Matrix" />
  </div>

  <!-- External libraries for generating a PDF from the form. html2canvas captures the
       rendered page into a canvas, and jsPDF converts it into a downloadable PDF.
       These are loaded from CDN to keep the page self‑contained without a build step. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    async function submitForm() {
      try {
        // Validate that at least one acknowledgement row has been completed and signed
        let acknowledged = false;
        const ackTable = document.getElementById('acknowledgement');
        if (ackTable) {
          const rows = ackTable.querySelectorAll('tbody tr');
          rows.forEach(row => {
            if (acknowledged) return;
            const nameInput = row.querySelector('input[name="ack_name[]"]');
            const dateInput = row.querySelector('input[name="ack_date[]"]');
            const pad = row.querySelector('canvas.signature-pad');
            const name = nameInput ? nameInput.value.trim() : '';
            const date = dateInput ? dateInput.value : '';
            const signed = pad ? pad.dataset.signed === 'true' : false;
            if (name && date && signed) {
              acknowledged = true;
            }
          });
        }
        if (!acknowledged) {
          alert('Please complete at least one SWMS Acknowledgement & Sign‑On entry including a hand drawn signature before submitting.');
          return;
        }
        // Generate a PDF of the entire document body
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'pt', 'a4');
        const element = document.body;
        const canvas = await html2canvas(element, { scale: 2 });
        const imgData = canvas.toDataURL('image/png');
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        // Build a filename from the main heading (e.g. project title) so that
        // each submission is clearly identifiable.  Non alphanumeric
        // characters are replaced with underscores.
        let headerText = '';
        const heading = document.querySelector('h1');
        if (heading) {
          headerText = heading.textContent.trim().replace(/\s+/g, ' ');
        }
        const safeName = headerText
          ? `${headerText.replace(/[^A-Za-z0-9\-_]/g, '_')}.pdf`
          : 'swms_signed.pdf';
        // Create a Blob from the PDF for upload.
        const pdfBlob = pdf.output('blob');
        // If a Power Automate flow URL has been configured, post the PDF to
        // that endpoint.  The flow should handle saving the file to
        // SharePoint using the received form data.  Replace the empty
        // string below with your Flow's HTTP trigger URL when ready.
        const powerAutomateUrl = '';
        if (powerAutomateUrl) {
          const formData = new FormData();
          formData.append('file', pdfBlob, safeName);
          await fetch(powerAutomateUrl, { method: 'POST', body: formData });
          alert('Your form has been submitted. It will be saved automatically to SharePoint.');
        } else {
          // Otherwise save the PDF locally so the user can attach it
          pdf.save(safeName);
          // Compose an email using the default mail client. Inform the user
          // to attach the saved PDF.  The saved file will have the same
          // name as generated above.
          const mailto =
            'mailto:choogwerf@pbegpr.com?subject=SWMS%20Form%20Signed&body=The%20SWMS%20form%20has%20been%20completed.%20A%20PDF%20copy%20named%20' +
            encodeURIComponent(safeName) +
            '%20has%20been%20saved%20to%20your%20device.%20Please%20attach%20it%20to%20this%20email.';
          window.location.href = mailto;
        }
      } catch (err) {
        alert('There was an error generating the PDF: ' + err.message);
      }
    }
  </script>
</body>
</html>